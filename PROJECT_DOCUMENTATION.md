# 📋 Paper Roll Management System - Master-Based Architecture

## 🎯 Project Overview

The **Paper Roll Management System** has been redesigned with a **master-driven architecture** that enhances data consistency, traceability, and modularity. The system transitions from table-centric design to a master-based approach where all entities reference centralized master tables.

### 🚀 **Key Features**
- **Master-Driven Design**: Centralized Client, User, Paper, and Inventory masters
- **Advanced Cutting Optimizer**: Specification-aware optimization with 1-5 rolls per jumbo
- **Pending Order Management**: Persistent tracking and reuse of unfulfilled requirements
- **Complete Traceability**: Every action logged with user identity and audit trail
- **Production Planning**: Auto-triggered production orders for missing inventory
- **Waste Minimization**: Intelligent trim-based decision making

### 🏗️ Master-Based System Architecture

```
┌─────────────────────────────────────────────────────────────────┐
│                    MASTER-BASED ARCHITECTURE                    │
├─────────────────────────────────────────────────────────────────┤
│  Client Master ←→ Order Master ←→ Paper Master                 │
│       ↓               ↓               ↓                         │
│  User Master  ←→ Plan Master  ←→ Inventory Master              │
│       ↓               ↓               ↓                         │
│  Pending Orders ←→ Fulfillment ←→ Production Orders            │
└─────────────────────────────────────────────────────────────────┘
```

---

## � **Updcated Full Workflow - Master-Based System**

### **1. 💼 Client Registration**
- Create or select a client from **Client Master**
- Clients are uniquely identified and linked to their orders
- **Fields**: `company_name`, `email`, `address`, `created_by`
- **Purpose**: Ensures consistent client data across all orders

### **2. 👤 User Onboarding**
- All users (sales, planners, supervisors) stored in **User Master**
- Users referenced in all critical actions for traceability
- **Fields**: `name`, `role`, `contact`, `password_hash`
- **Purpose**: Complete audit trail of who performed each action

### **3. 📄 Paper Configuration**
- Paper specs (GSM, BF, Shade, Name) centralized in **Paper Master**
- Ensures consistent specification usage across platform
- **Fields**: `name`, `gsm`, `bf`, `shade`, `thickness`, `type`
- **Purpose**: Standardizes paper specifications and prevents inconsistencies

### **4. 📦 Order Placement**
- New order placed by selecting client and choosing paper specs
- Order linked to **Paper Master** and **Client Master**
- **Fields**: `client_id`, `paper_id`, `width`, `quantity`, `created_by`, `status`
- **Purpose**: Creates traceable order with standardized specifications

### **5. 🕒 Pending Order Handling**
- If inventory insufficient, pending order created automatically
- Pending orders grouped and reused in future optimization runs
- **Fields**: `order_id`, `paper_id`, `width`, `quantity_pending`, `reason`, `status`
- **Purpose**: Tracks unfulfilled requirements for batch processing

### **6. 📦 Inventory Management**
- Jumbo and Cut Rolls managed in **Inventory Master**
- Inventory entries tied to **Paper Master** and allocated to orders
- **Fields**: `paper_id`, `width`, `weight`, `roll_type` (jumbo/cut), `status`, `location`
- **Purpose**: Centralized inventory with paper specification linkage

### **7. ✂️ Plan Generation**
- Cutting plans generated by selecting orders + available inventory
- Each plan logs planner (user), paper used, and rolls involved
- **Fields**: `order_ids[]`, `inventory_ids[]`, `created_by`, `trim_%`, `pattern`, `status`
- **Purpose**: Optimized cutting with complete traceability

### **8. 🚚 Order Fulfillment**
- Based on generated plans, inventory assigned to fulfill orders
- Cut rolls linked back to order and inventory updated
- Order status updated; remaining quantity becomes pending
- **Purpose**: Executes cutting plans and updates order status

### **9. 🔁 Production Planning**
- If no jumbo exists for pending item, production order triggered
- References **Paper Master** and links to pending order
- Used to plan new jumbo production as needed
- **Purpose**: Ensures continuous supply of required specifications

### **10. 📋 Full Traceability & Audits**
- Every change logs user identity (`created_by`, `fulfilled_by`, `planned_by`)
- Roll tracking, cutting history, and client fulfillment fully traceable
- All entities follow master-based foreign key relationships
- **Purpose**: Complete audit trail and accountability

---

## 🗄️ **Core Master Tables**

| Master Table | Purpose | Used In |
|--------------|---------|---------|
| **Client Master** | Stores client details | Orders, Fulfillment |
| **User Master** | Tracks all system users | Audit, Plan, Order |
| **Paper Master** | Standardizes paper specs | Orders, Inventory, Planning |
| **Order Master** | Stores order details | Planning, Fulfillment |
| **Pending Order Master** | Tracks unfulfilled orders | Planning, Production |
| **Inventory Master** | Manages jumbo and cut rolls | Order Fulfillment, Planning |
| **Plan Master** | Holds cutting optimization plans | Fulfillment, Audit |

---

## 🗃️ **Database Schema - Master-Based Design**

### **Master Tables**

```sql
-- Client Master
client_master: id, company_name, email, address, contact_person, 
               phone, created_by, created_at, status

-- User Master  
user_master: id, name, username, password_hash, role, contact, 
             department, created_at, last_login, status

-- Paper Master
paper_master: id, name, gsm, bf, shade, thickness, type, 
              created_by, created_at, status

-- Inventory Master
inventory_master: id, paper_id, width_inches, weight_kg, 
                  roll_type, location, status, created_by, created_at
```

### **Transaction Tables**

```sql
-- Order Master
order_master: id, client_id, paper_id, width_inches, quantity_rolls,
              quantity_fulfilled, status, created_by, created_at

-- Pending Order Master
pending_order_master: id, order_id, paper_id, width_inches, 
                      quantity_pending, reason, status, created_at

-- Plan Master
plan_master: id, order_ids, inventory_ids, cut_pattern, 
             expected_waste_percentage, actual_waste_percentage,
             created_by, status, created_at

-- Production Order Master
production_order_master: id, paper_id, quantity, priority,
                         status, created_by, created_at, completed_at
```

---

## 🔧 **Core Technologies**

| Technology | Purpose | Version |
|------------|---------|---------|
| **FastAPI** | Web framework | 0.104.1 |
| **SQLAlchemy** | ORM & Database | 2.0.23 |
| **Pydantic** | Data validation | 2.4.2 |
| **MSSQL Server** | Database | SQL Server Express |
| **Alembic** | Database migrations | Latest |
| **Uvicorn** | ASGI server | 0.24.0 |

---

## 🚀 **API Endpoints - Master-Based**

### **Master Management**
```
GET    /api/clients                    # List all clients
POST   /api/clients                    # Create new client
GET    /api/papers                     # List paper specifications
POST   /api/papers                     # Create paper specification
GET    /api/users                      # List system users
POST   /api/users                      # Create new user
```

### **Order Management**
```
GET    /api/orders                     # List orders
POST   /api/orders                     # Create order (linked to masters)
GET    /api/orders/{id}                # Get order details
PUT    /api/orders/{id}/fulfill        # Fulfill order
```

### **Inventory Management**
```
GET    /api/inventory                  # List inventory items
POST   /api/inventory                  # Add inventory item
GET    /api/inventory/jumbo-rolls      # List jumbo rolls
GET    /api/inventory/cut-rolls        # List cut rolls
```

### **Planning & Optimization**
```
POST   /api/plans/generate             # Generate cutting plan
GET    /api/plans                      # List cutting plans
POST   /api/plans/{id}/execute         # Execute cutting plan
GET    /api/pending-orders             # List pending orders
```

### **Production Management**
```
GET    /api/production-orders          # List production orders
POST   /api/production-orders          # Create production order
PUT    /api/production-orders/{id}/complete # Complete production
```

---

## 🔄 **Workflow Examples**

### **Example 1: New Order Processing**
```
1. Select Client from Client Master → client_id
2. Select Paper from Paper Master → paper_id  
3. Create Order: {client_id, paper_id, width, quantity, created_by}
4. System checks Inventory Master for availability
5. If insufficient → Create Pending Order
6. Generate Plan using available inventory + pending orders
7. Execute Plan → Update inventory, fulfill orders
8. Remaining quantity → New Pending Orders
```

### **Example 2: Batch Optimization**
```
1. Collect Pending Orders by paper_id (same specification)
2. Find available Inventory by paper_id
3. Run Cutting Optimizer with grouped orders
4. Generate Plan Master entry with order_ids[] and inventory_ids[]
5. Execute Plan → Create Cut Rolls, Update Orders
6. Log all actions with user_id for traceability
```

---

## 🎯 **Benefits of Master-Based Design**

### **Data Consistency**
- ✅ Centralized paper specifications prevent inconsistencies
- ✅ Client data standardized across all orders
- ✅ User actions fully traceable

### **Modularity**
- ✅ Easy to add new paper types via Paper Master
- ✅ Client management independent of orders
- ✅ Inventory management centralized

### **Traceability**
- ✅ Every action linked to User Master
- ✅ Complete audit trail from order to fulfillment
- ✅ Roll tracking through entire lifecycle

### **Scalability**
- ✅ Master tables support unlimited entries
- ✅ Foreign key relationships maintain data integrity
- ✅ Easy to extend with new master types

---

## 🔧 **Implementation Status**

| Component | Status | Notes |
|-----------|--------|-------|
| **Client Master** | 🟡 Planned | Need to implement client management |
| **User Master** | ✅ Complete | Basic user system implemented |
| **Paper Master** | 🟡 Planned | Currently using inline specifications |
| **Order Master** | ✅ Complete | Order system functional |
| **Pending Orders** | ✅ Complete | Persistent pending order tracking |
| **Inventory Master** | 🟡 Partial | Basic inventory, needs master linkage |
| **Plan Master** | ✅ Complete | Cutting plans with optimization |
| **Production Orders** | ✅ Complete | Production planning system |

---

## 🚀 **Next Steps for Full Master Implementation**

1. **Create Client Master** - Implement client management system
2. **Implement Paper Master** - Centralize paper specifications
3. **Update Order System** - Link orders to Client and Paper masters
4. **Enhance Inventory** - Link inventory items to Paper Master
5. **Add Master APIs** - Create CRUD endpoints for all masters
6. **Update Frontend** - Modify UI to use master-based dropdowns
7. **Data Migration** - Migrate existing data to master-based structure

This master-based architecture provides a solid foundation for scalable, traceable, and consistent paper roll management operations.